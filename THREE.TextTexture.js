!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("three")):"function"==typeof define&&define.amd?define(["three"],i):(t.THREE=t.THREE||{},t.THREE.TextTexture=i(t.THREE))}(this,function(P){"use strict";function S(){return document.createElement("canvas")}function e(t){return void 0===t}function n(t,i){if(t.length){var e=S().getContext("2d");return e.font=i,function(t){if(0<t.length)return t.reduce(function(t,i){return Math.max(t,i)})}(t.map(function(t){return e.measureText(t).width}))}return 0}return function(W){function t(t){void 0===t&&(t={});var i=t.autoRedraw;void 0===i&&(i=!0);var e=t.text;void 0===e&&(e="");var n=t.textAlign;void 0===n&&(n="center");var o=t.lineHeight;void 0===o&&(o=1.15);var s=t.fontFamily;void 0===s&&(s="sans-serif");var h=t.fontSize;void 0===h&&(h=16);var r=t.fontWeight;void 0===r&&(r="normal");var a=t.fontVariant;void 0===a&&(a="normal");var l=t.fontStyle;void 0===l&&(l="normal");var f=t.strokeStyle;void 0===f&&(f="white");var d=t.outlineWidth;void 0===d&&(d=0);var g=t.padding;void 0===g&&(g=.25);var u=t.magFilter;void 0===u&&(u=P.LinearFilter);var x=t.minFilter;void 0===x&&(x=P.LinearFilter);var c=t.mapping,_=t.wrapS,p=t.wrapT,v=t.format,I=t.type,y=t.anisotropy;W.call(this,S(),c,_,p,u,x,v,I,y),this.autoRedraw=i,this._text=e,this._textAlign=n,this._lineHeight=o,this._fontFamily=s,this._fontSize=h,this._fontWeight=r,this._fontVariant=a,this._fontStyle=l,this._padding=g,this._strokeStyle=f,this._outlineWidth=d,this.redraw()}W&&(t.__proto__=W);var i={text:{configurable:!0},textAlign:{configurable:!0},lines:{configurable:!0},lineHeight:{configurable:!0},lineHeightInPixels:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontWeight:{configurable:!0},fontVariant:{configurable:!0},fontStyle:{configurable:!0},font:{configurable:!0},textBoxWidthInPixels:{configurable:!0},textBoxHeight:{configurable:!0},textBoxHeightInPixels:{configurable:!0},padding:{configurable:!0},strokeStyle:{configurable:!0},outlineWidth:{configurable:!0},paddingInPixels:{configurable:!0},paddingBoxWidthInPixels:{configurable:!0},paddingBoxHeight:{configurable:!0},paddingBoxHeightInPixels:{configurable:!0},aspect:{configurable:!0}};return((t.prototype=Object.create(W&&W.prototype)).constructor=t).prototype.redraw=function(){var i=this,e=this.image.getContext("2d");if(e.clearRect(0,0,e.canvas.width,e.canvas.height),this.textBoxWidthInPixels&&this.textBoxHeightInPixels){var n;switch(e.canvas.width=this.paddingBoxWidthInPixels,e.canvas.height=this.paddingBoxHeightInPixels,e.font=this.font,e.textBaseline="middle",e.fillStyle="White",this.textAlign){case"left":e.textAlign="left",n=this.paddingInPixels;break;case"right":e.textAlign="right",n=this.paddingInPixels+this.textBoxWidthInPixels;break;case"center":e.textAlign="center",n=this.paddingInPixels+this.textBoxWidthInPixels/2}var o=this.paddingInPixels+this.fontSize/2;e.strokeStyle=this.strokeStyle,e.lineWidth=this.outlineWidth,this.lines.forEach(function(t){e.strokeText(t,n,o),e.fillText(t,n,o),o+=i.lineHeightInPixels})}else e.canvas.width=e.canvas.height=1;this.needsUpdate=!0},t.prototype._redrawIfAuto=function(){this.autoRedraw&&this.redraw()},i.text.get=function(){return this._text},i.text.set=function(t){this._text!==t&&(this._text=t,this._lines=void 0,this._textBoxWidthInPixels=void 0,this._redrawIfAuto())},i.textAlign.get=function(){return this._textAlign},i.textAlign.set=function(t){this._textAlign!==t&&(this._textAlign=t,this._redrawIfAuto())},i.lines.get=function(){var t;return e(this._lines)&&(this._lines=(t=this.text)?t.split("\n"):[]),this._lines},i.lineHeight.get=function(){return this._lineHeight},i.lineHeight.set=function(t){this._lineHeight!==t&&(this._lineHeight=t,this._redrawIfAuto())},i.lineHeightInPixels.get=function(){return this.fontSize*this.lineHeight},i.fontFamily.get=function(){return this._fontFamily},i.fontFamily.set=function(t){this._fontFamily!==t&&(this._fontFamily=t,this._textBoxWidthInPixels=void 0,this._redrawIfAuto())},i.fontSize.get=function(){return this._fontSize},i.fontSize.set=function(t){this._fontSize!==t&&(this._fontSize=t,this._textBoxWidthInPixels=void 0,this._redrawIfAuto())},i.fontWeight.get=function(){return this._fontWeight},i.fontWeight.set=function(t){this._fontWeight!==t&&(this._fontWeight=t,this._textBoxWidthInPixels=void 0,this._redrawIfAuto())},i.fontVariant.get=function(){return this._fontVariant},i.fontVariant.set=function(t){this._fontVariant!==t&&(this._fontVariant=t,this._textBoxWidthInPixels=void 0,this._redrawIfAuto())},i.fontStyle.get=function(){return this._fontStyle},i.fontStyle.set=function(t){this._fontStyle!==t&&(this._fontStyle=t,this._textBoxWidthInPixels=void 0,this._redrawIfAuto())},i.font.get=function(){return t=this.fontStyle,i=this.fontVariant,e=this.fontWeight,n=this.fontSize,o=this.fontFamily,[t,i,e,n+"px",o].join(" ");var t,i,e,n,o},i.textBoxWidthInPixels.get=function(){return e(this._textBoxWidthInPixels)&&(this._textBoxWidthInPixels=n(this.lines,this.font)),this._textBoxWidthInPixels},i.textBoxHeight.get=function(){return this.lineHeight*(this.lines.length-1)+1},i.textBoxHeightInPixels.get=function(){return this.fontSize*this.textBoxHeight},i.padding.get=function(){return this._padding},i.padding.set=function(t){this._padding!==t&&(this._padding=t,this._redrawIfAuto())},i.strokeStyle.set=function(t){this._strokeStyle!==t&&(this._strokeStyle=t,this._redrawIfAuto())},i.strokeStyle.get=function(){return this._strokeStyle},i.outlineWidth.set=function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._redrawIfAuto())},i.outlineWidth.get=function(){return this._outlineWidth},i.paddingInPixels.get=function(){return this.fontSize*this.padding},i.paddingBoxWidthInPixels.get=function(){return this.textBoxWidthInPixels+2*this.paddingInPixels},i.paddingBoxHeight.get=function(){return this.textBoxHeight+2*this.padding},i.paddingBoxHeightInPixels.get=function(){return this.textBoxHeightInPixels+2*this.paddingInPixels},i.aspect.get=function(){return this.image.width&&this.image.height?this.image.width/this.image.height:1},Object.defineProperties(t.prototype,i),t}(P.Texture)});

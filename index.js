!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):((t=t||self).THREE=t.THREE||{},t.THREE.TextTexture=e(t.THREE))}(this,(function(t){"use strict";function e(t,e,i,n,r){return[i,n,r,e+"px",t].join(" ")}var i=function(i){function n(e){void 0===e&&(e={});var n=e.align;void 0===n&&(n="center");var r=e.fillStyle;void 0===r&&(r="#fff");var o=e.fontFamily;void 0===o&&(o="sans-serif");var a=e.fontSize;void 0===a&&(a=16);var h=e.fontStyle;void 0===h&&(h="normal");var s=e.fontVariant;void 0===s&&(s="normal");var l=e.fontWeight;void 0===l&&(l="normal");var f=e.lineGap;void 0===f&&(f=.15);var d=e.padding;void 0===d&&(d=.25);var c=e.strokeStyle;void 0===c&&(c="#000");var g=e.strokeWidth;void 0===g&&(g=0);var u=e.text;void 0===u&&(u=""),i.call(this,document.createElement("canvas"),void 0,void 0,void 0,t.LinearFilter,t.LinearFilter),Object.assign(this,{_align:n,_fillStyle:r,_fontFamily:o,_fontSize:a,_fontStyle:h,_fontVariant:s,_fontWeight:l,_lineGap:f,_padding:d,_strokeStyle:c,_strokeWidth:g,_text:u,needsRedraw:!0})}i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n;var r={lines:{configurable:!0},textWidth:{configurable:!0},textHeight:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return r.lines.get=function(){var t=this.text;return t?t.split("\n"):[]},r.textWidth.get=function(){var t=this.fontFamily,i=this.fontStyle,n=this.fontVariant,r=this.fontWeight,o=this.lines;if(o.length){var a=document.createElement("canvas").getContext("2d");return a.font=e(t,1,i,n,r),o.map((function(t){return a.measureText(t).width})).reduce((function(t,e){return Math.max(t,e)}))}return 0},r.textHeight.get=function(){var t=this.lineGap,e=this.lines;return e.length?e.length+t*(e.length-1):0},r.width.get=function(){var t=this.padding;return 2*(t+=this.strokeWidth/2)+this.textWidth},r.height.get=function(){var t=this.padding;return 2*(t+=this.strokeWidth/2)+this.textHeight},Object.defineProperties(n.prototype,r),n}(t.Texture);var n=new t.Vector3,r=new t.Vector3,o=new t.Vector3;var a={computeAndSetOptimalFontSize:function(){for(var t,e=[],i=arguments.length;i--;)e[i]=arguments[i];this.fontSize=(t=this).computeOptimalFontSize.apply(t,e)},computeOptimalFontSize:function(e,i,a,h){var s=this.height,l=this.width;if(l&&s){var f=(i.capabilities||{}).maxTextureSize||1/0;e.getWorldPosition(r),a.getWorldPosition(n);var d=r.distanceTo(n);if(a.isPerspectiveCamera&&(d*=2*Math.tan(t.Math.degToRad(a.fov)/2)),(a.isPerspectiveCamera||a.isOrthographicCamera)&&(d/=a.zoom),d){e.getWorldScale(o);var c=o.y*i.domElement.offsetHeight/d/s;return h&&(c=t.Math.ceilPowerOfTwo(c)),s*=c,((l*=c)>f||s>f)&&(c*=f/Math.max(l,s),h&&(c=t.Math.floorPowerOfTwo(c))),c}}return 0},isTextTexture:!0,redraw:function(){if(this.needsRedraw){var t=this.image;if(t){var i=this.fontSize,n=this.height,r=this.width,o=t.getContext("2d");if(o.clearRect(0,0,t.width,t.height),n*=i,(r*=i)&&n){t.width=r,t.height=n;var a,h=this.align,s=this.fillStyle,l=this.fontFamily,f=this.fontStyle,d=this.fontVariant,c=this.fontWeight,g=this.lineGap,u=this.lines,v=this.padding,p=this.strokeStyle,m=this.strokeWidth;switch(v+=m/2,m*=i,g*=i,v*=i,o.font=e(l,i,f,d,c),h){case"left":o.textAlign="left",a=v;break;case"right":o.textAlign="right",a=r-v;break;case"center":o.textAlign="center",a=r/2}o.textBaseline="top";var y=v;o.fillStyle=s,o.miterLimit=1,o.lineWidth=m,o.strokeStyle=p,u.forEach((function(t){m&&o.strokeText(t,a,y),o.fillText(t,a,y),y+=i+g}))}else t.width=t.height=1;this.needsRedraw=!1,this.needsUpdate=!0}}}},h=i.prototype;return Object.entries({_align:"align",_fillStyle:"fillStyle",_fontFamily:"fontFamily",_fontSize:"fontSize",_fontStyle:"fontStyle",_fontVariant:"fontVariant",_fontWeight:"fontWeight",_lineGap:"lineGap",_padding:"padding",_strokeStyle:"strokeStyle",_strokeWidth:"strokeWidth",_text:"text"}).forEach((function(t){var e=t[0],i=t[1];Object.defineProperty(h,i,{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,this.needsRedraw=!0)}})})),Object.assign(h,a),i}));

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):((t=t||self).THREE=t.THREE||{},t.THREE.TextTexture=e(t.THREE))}(this,(function(t){"use strict";function e(){}function n(t){return new Promise((function(e){setTimeout(e,t)}))}function i(t){return new Promise((function(e){e(t())}))}function r(){return document.createElement("canvas")}function o(t,e,n,i,r){return[n,i,r,e+"px",t].join(" ")}function a(t,e,n,i){var r=o(t,1,e,n,i);return document.fonts.load(r)}function f(){var t=this;return i((function(){if(t.needsRedraw){var e=t.image;if(e){var n=t,r=n.align,a=n.fillStyle,f=n.fontFamily,l=n.fontSize,s=n.fontStyle,d=n.fontVariant,c=n.fontWeight,u=n.height,h=n.lineGap,v=n.lines,g=n.loadFontFace,p=n.padding,y=n.strokeStyle,m=n.strokeWidth;return i((function(){return g(f,s,d,c)})).then((function(){var n=e.getContext("2d");n.clearRect(0,0,e.width,e.height),u*=l,h*=l,p*=l,p+=(m*=l)/2;var i=o(f,l,s,d,c),g=2*p;if(v.length&&(n.font=i,g+=v.map((function(t){return n.measureText(t).width})).reduce((function(t,e){return Math.max(t,e)}))),g&&u){var _;switch(e.width=g,e.height=u,n.font=i,r){case"left":n.textAlign="left",_=p;break;case"right":n.textAlign="right",_=g-p;break;case"center":n.textAlign="center",_=g/2}n.textBaseline="top";var S=p;n.fillStyle=a,n.miterLimit=1,n.lineWidth=m,n.strokeStyle=y,v.forEach((function(t){m&&n.strokeText(t,_,S),n.fillText(t,_,S),S+=l+h}))}else e.width=e.height=1;t.needsRedraw=!1,t.needsUpdate=!0}))}}}))}var l=function(o){function l(l){void 0===l&&(l={});var s=l.align;void 0===s&&(s="center");var d=l.createCanvas;void 0===d&&(d=r);var c=l.fillStyle;void 0===c&&(c="#fff");var u=l.fontFamily;void 0===u&&(u="sans-serif");var h=l.fontSize;void 0===h&&(h=16);var v=l.fontStyle;void 0===v&&(v="normal");var g=l.fontVariant;void 0===g&&(g="normal");var p=l.fontWeight;void 0===p&&(p="normal");var y=l.lineGap;void 0===y&&(y=.15);var m=l.loadFontFace;void 0===m&&(m=a);var _=l.padding;void 0===_&&(_=.25);var S=l.strokeStyle;void 0===S&&(S="#000");var x=l.strokeWidth;void 0===x&&(x=0);var w,k,T,W,F,E,b=l.text;void 0===b&&(b=""),o.call(this,d(),void 0,void 0,void 0,t.LinearFilter,t.LinearFilter),Object.assign(this,{_align:s,_fillStyle:c,_fontFamily:u,_fontSize:h,_fontStyle:v,_fontVariant:g,_fontWeight:p,_lineGap:y,_padding:_,_strokeStyle:S,_strokeWidth:x,_text:b,createCanvas:d,loadFontFace:m,needsRedraw:!0,redraw:(w=f,k=1,E=Promise.resolve(),function(){for(var t=this,r=[],o=arguments.length;o--;)r[o]=arguments[o];return i((function(){return W=t,F=r,T||(T=new Promise((function(t){E=E.then((function(){return n(k)})).then((function(){try{var e=w.apply(W,F);return t(e),e}finally{T=null}})).catch(e)}))),T}))})}),this.redraw()}o&&(l.__proto__=o),l.prototype=Object.create(o&&o.prototype),l.prototype.constructor=l;var s={lines:{configurable:!0},height:{configurable:!0}};return s.lines.get=function(){var t=this.text;return t?t.split("\n"):[]},s.height.get=function(){var t=this.lineGap,e=this.lines,n=this.padding,i=2*(n+=this.strokeWidth/2);return e.length&&(i+=e.length+t*(e.length-1)),i},Object.defineProperties(l.prototype,s),l}(t.Texture),s=new t.Vector3,d=new t.Vector3,c=new t.Vector3;var u={computeOptimalFontSize:function(e,n,i){var r=this.height;if(r){var o=e.getWorldPosition(d).distanceTo(i.getWorldPosition(s));if(i.isPerspectiveCamera&&(o*=2*Math.tan(t.Math.degToRad(i.fov)/2)),(i.isPerspectiveCamera||i.isOrthographicCamera)&&(o/=i.zoom),o)return Math.round(e.getWorldScale(c).y*n.domElement.offsetHeight/o/r)}return 0},isTextTexture:!0},h=l.prototype;return Object.entries({_align:"align",_fillStyle:"fillStyle",_fontFamily:"fontFamily",_fontSize:"fontSize",_fontStyle:"fontStyle",_fontVariant:"fontVariant",_fontWeight:"fontWeight",_lineGap:"lineGap",_padding:"padding",_strokeStyle:"strokeStyle",_strokeWidth:"strokeWidth",_text:"text"}).forEach((function(t){var e=t[0],n=t[1];Object.defineProperty(h,n,{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,this.needsRedraw=!0,this.redraw())}})})),Object.assign(h,u),l}));

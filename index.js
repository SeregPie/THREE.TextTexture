!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e.THREE||{},e.THREE.TextTexture=t(e.THREE))}(this,(function(e){"use strict";let t=class extends e.Texture{constructor(){super(document.createElement("canvas"));let t=null,i=()=>t||(t=this.createDrawable()),n=()=>i().width,o=()=>i().height,r=!0,l=1,a=()=>e.MathUtils.ceilPowerOfTwo(n()*l),s=()=>e.MathUtils.ceilPowerOfTwo(o()*l),f=e=>{if(l!==e){let t=a(),i=s();l=e;let n=a(),o=s();n===t&&o===i||(r=!0)}},h=(()=>{let t=new e.Vector3,i=new e.Vector3,r=new e.Vector3;return(e,l,a)=>{let s=n(),f=o();if(s&&f){e.getWorldPosition(i),a.getWorldPosition(t);let n=i.distanceTo(t);if(a.isPerspectiveCamera&&(n*=2*Math.tan(THREE.Math.degToRad(a.fov)/2)),(a.isPerspectiveCamera||a.isOrthographicCamera)&&(n/=a.zoom),n){var h,d;e.getWorldScale(r);let t=null!==(h=null===(d=l.capabilities)||void 0===d?void 0:d.maxTextureSize)&&void 0!==h?h:1/0;return Math.min(Math.max(r.x/n*(l.domElement.offsetWidth/s),r.y/n*(l.domElement.offsetHeight/f)),t/s,t/f)}}return 0}})();Object.defineProperties(this,{width:{get:n},height:{get:o},pixelRatio:{get:()=>l,set:f},needsRedraw:{set(e){e&&(r=!0,t=null)}}}),Object.assign(this,{redraw(){if(r){let e=this.image,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),e.width=a(),e.height=s(),t.save(),t.scale(e.width/n(),e.height/o()),((...e)=>{i().draw(...e)})(t),t.restore(),r=!1,this.needsUpdate=!0}},setOptimalPixelRatio(...e){f(h(...e))}})}};t.prototype.isDynamicTexture=!0;let i=class extends t{constructor({alignment:e="center",color:t="#fff",fontFamily:i="sans-serif",fontSize:n=16,fontStyle:o="normal",fontVariant:r="normal",fontWeight:l="normal",lineGap:a=.5,padding:s=1,strokeColor:f="#fff",strokeWidth:h=0,text:d=""}={}){super(),Object.entries({alignment:e,color:t,fontFamily:i,fontSize:n,fontStyle:o,fontVariant:r,fontWeight:l,lineGap:a,padding:s,strokeColor:f,strokeWidth:h,text:d}).forEach((([e,t])=>{Object.defineProperty(this,e,{get:()=>t,set(e){t!==e&&(this.needsRedraw=!0)}})}))}get font(){return function(e,t,i,n,o){let r=document.createElement("span");return r.style.font="1px serif",r.style.fontFamily=e,r.style.fontSize="".concat(t,"px"),r.style.fontStyle=i,r.style.fontVariant=n,r.style.fontWeight=o,r.style.font}(this.fontFamily,this.fontSize,this.fontStyle,this.fontVariant,this.fontWeight)}createDrawable(){let{alignment:e,color:t,font:i,fontSize:n,lineGap:o,padding:r,strokeColor:l,strokeWidth:a,text:s}=this;r*=n,o*=n,a*=n;let f=s?s.split("\n"):[],h=f.length,d=n+o,c=h?(()=>{let e=document.createElement("canvas").getContext("2d");return e.font=i,Math.max(...f.map((t=>e.measureText(t).width)))})():0,m=r+a/2,g=c+2*m;return{width:g,height:(h?n+d*(h-1):0)+2*m,draw(o){let r,s=m+n/2;Object.assign(o,{fillStyle:t,font:i,lineWidth:a,miterLimit:1,strokeStyle:l,textAlign:(()=>{switch(e){case"left":return r=m,"left";case"right":return r=g-m,"right"}return r=g/2,"center"})(),textBaseline:"middle"}),f.forEach((e=>{o.fillText(e,r,s),a&&o.strokeText(e,r,s),s+=d}))}}}};return i.prototype.isTextTexture=!0,i}));

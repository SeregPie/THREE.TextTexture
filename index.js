!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):((t=t||self).THREE=t.THREE||{},t.THREE.TextTexture=e(t.THREE))}(this,(function(t){"use strict";function e(t,e,i,n,r){return[i,n,r,e+"px",t].join(" ")}var i=function(i){function n(e){void 0===e&&(e={});var n=e.align;void 0===n&&(n="center");var r=e.fillStyle;void 0===r&&(r="#fff");var o=e.fontFamily;void 0===o&&(o="sans-serif");var a=e.fontSize;void 0===a&&(a=16);var s=e.fontStyle;void 0===s&&(s="normal");var h=e.fontVariant;void 0===h&&(h="normal");var l=e.fontWeight;void 0===l&&(l="normal");var f=e.lineGap;void 0===f&&(f=.15);var d=e.padding;void 0===d&&(d=.25);var c=e.strokeStyle;void 0===c&&(c="#000");var g=e.strokeWidth;void 0===g&&(g=0);var u=e.text;void 0===u&&(u=""),i.call(this,document.createElement("canvas"),void 0,void 0,void 0,t.LinearFilter,t.LinearFilter),Object.assign(this,{_align:n,_fillStyle:r,_fontFamily:o,_fontSize:a,_fontStyle:s,_fontVariant:h,_fontWeight:l,_lineGap:f,_padding:d,_scale:1,_strokeStyle:c,_strokeWidth:g,_text:u,needsRedraw:!0})}i&&(n.__proto__=i),n.prototype=Object.create(i&&i.prototype),n.prototype.constructor=n;var r={lines:{configurable:!0},textWidth:{configurable:!0},textHeight:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return r.lines.get=function(){var t=this.text;return t?t.split("\n"):[]},r.textWidth.get=function(){var t=this.fontFamily,i=this.fontSize,n=this.fontStyle,r=this.fontVariant,o=this.fontWeight,a=this.lines;if(a.length){var s=document.createElement("canvas").getContext("2d");return s.font=e(t,i,n,r,o),a.map((function(t){return s.measureText(t).width})).reduce((function(t,e){return Math.max(t,e)}))}return 0},r.textHeight.get=function(){var t=this.fontSize,e=this.lineGap,i=this.lines;return i.length?(i.length+e*(i.length-1))*t:0},r.width.get=function(){var t=this.fontSize,e=this.padding;return e+=this.strokeWidth/2,2*(e*=t)+this.textWidth},r.height.get=function(){var t=this.fontSize,e=this.padding;return e+=this.strokeWidth/2,2*(e*=t)+this.textHeight},Object.defineProperties(n.prototype,r),n}(t.Texture);var n=new t.Vector3,r=new t.Vector3,o=new t.Vector3;var a={computeAndSetOptimalScale:function(){for(var t,e=[],i=arguments.length;i--;)e[i]=arguments[i];this.scale=(t=this).computeOptimalScale.apply(t,e)},computeOptimalScale:function(e,i,a,s){var h=this.height,l=this.width;if(l&&h){var f=(i.capabilities||{}).maxTextureSize||1/0;e.getWorldPosition(r),a.getWorldPosition(n);var d=r.distanceTo(n);if(a.isPerspectiveCamera&&(d*=2*Math.tan(t.Math.degToRad(a.fov)/2)),(a.isPerspectiveCamera||a.isOrthographicCamera)&&(d/=a.zoom),d){e.getWorldScale(o);var c=o.y*i.domElement.offsetHeight/d/h;return s&&(c=t.Math.ceilPowerOfTwo(c)),h*=c,((l*=c)>f||h>f)&&(c*=f/Math.max(l,h),s&&(c=t.Math.floorPowerOfTwo(c))),c}}return 0},isTextTexture:!0,redraw:function(){if(this.needsRedraw){var t=this.image;if(t){var i=this.height,n=this.scale,r=this.width,o=t.getContext("2d");if(o.clearRect(0,0,t.width,t.height),i*=n,(r*=n)&&i){t.width=r,t.height=i;var a,s=this.align,h=this.fillStyle,l=this.fontFamily,f=this.fontSize,d=this.fontStyle,c=this.fontVariant,g=this.fontWeight,u=this.lineGap,v=this.lines,p=this.padding,m=this.strokeStyle,y=this.strokeWidth;switch(p+=y/2,y*=f*=n,u*=f,p*=f,o.font=e(l,f,d,c,g),s){case"left":o.textAlign="left",a=p;break;case"right":o.textAlign="right",a=r-p;break;case"center":o.textAlign="center",a=r/2}o.textBaseline="top";var S=p;o.fillStyle=h,o.miterLimit=1,o.lineWidth=y,o.strokeStyle=m,v.forEach((function(t){y&&o.strokeText(t,a,S),o.fillText(t,a,S),S+=f+u}))}else t.width=t.height=1;this.needsRedraw=!1,this.needsUpdate=!0}}}},s=i.prototype;return Object.entries({_align:"align",_fillStyle:"fillStyle",_fontFamily:"fontFamily",_fontSize:"fontSize",_fontStyle:"fontStyle",_fontVariant:"fontVariant",_fontWeight:"fontWeight",_lineGap:"lineGap",_padding:"padding",_scale:"scale",_strokeStyle:"strokeStyle",_strokeWidth:"strokeWidth",_text:"text"}).forEach((function(t){var e=t[0],i=t[1];Object.defineProperty(s,i,{get:function(){return this[e]},set:function(t){this[e]!==t&&(this[e]=t,this.needsRedraw=!0)}})})),Object.assign(s,a),i}));

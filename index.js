!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three")):"function"==typeof define&&define.amd?define(["three"],e):((t="undefined"!=typeof globalThis?globalThis:t||self).THREE=t.THREE||{},t.THREE.TextTexture=e(t.THREE))}(this,(function(t){"use strict";let e=class extends t.Texture{constructor(){super(document.createElement("canvas"));let e=null,n=()=>e||(e=this.createDrawable()),i=()=>n().width,o=()=>n().height,r=!0,l=1,s=()=>t.MathUtils.ceilPowerOfTwo(i()*l),a=()=>t.MathUtils.ceilPowerOfTwo(o()*l),f=t=>{if(l!==t){let e=s(),n=a();l=t;let i=s(),o=a();i===e&&o===n||(r=!0)}},h=(()=>{let e=new t.Vector3,n=new t.Vector3,r=new t.Vector3;return(t,l,s)=>{let a=i(),f=o();if(a&&f){t.getWorldPosition(n),s.getWorldPosition(e);let i=n.distanceTo(e);if(s.isPerspectiveCamera&&(i*=2*Math.tan(THREE.Math.degToRad(s.fov)/2)),(s.isPerspectiveCamera||s.isOrthographicCamera)&&(i/=s.zoom),i){var h,d;t.getWorldScale(r);let e=null!==(h=null===(d=l.capabilities)||void 0===d?void 0:d.maxTextureSize)&&void 0!==h?h:1/0;return Math.min(Math.max(r.x/i*(l.domElement.offsetWidth/a),r.y/i*(l.domElement.offsetHeight/f)),e/a,e/f)}}return 0}})();Object.defineProperties(this,{width:{get:i},height:{get:o},pixelRatio:{get:()=>l,set:f},needsRedraw:{set(t){t&&(r=!0,e=null)}}}),Object.assign(this,{redraw(){if(r){let t=this.image,e=t.getContext("2d");e.clearRect(0,0,t.width,t.height),t.width=s(),t.height=a(),t.width&&t.height?(e.save(),e.scale(t.width/i(),t.height/o()),((...t)=>{n().draw(...t)})(e),e.restore()):t.width=t.height=1,r=!1,this.needsUpdate=!0}},setOptimalPixelRatio(...t){f(h(...t))}})}};e.prototype.isDynamicTexture=!0;let n=class extends e{constructor({alignment:t="center",color:e="#fff",fontFamily:n="sans-serif",fontSize:i=16,fontStyle:o="normal",fontVariant:r="normal",fontWeight:l="normal",lineGap:s=1/4,padding:a=.5,strokeColor:f="#fff",strokeWidth:h=0,text:d=""}={}){super(),Object.entries({alignment:t,color:e,fontFamily:n,fontSize:i,fontStyle:o,fontVariant:r,fontWeight:l,lineGap:s,padding:a,strokeColor:f,strokeWidth:h,text:d}).forEach((([t,e])=>{Object.defineProperty(this,t,{get:()=>e,set(t){e!==t&&(e=t,this.needsRedraw=!0)}})}))}get font(){return function(t,e,n,i,o){let r=document.createElement("span");return r.style.font="1px serif",r.style.fontFamily=t,r.style.fontSize="".concat(e,"px"),r.style.fontStyle=n,r.style.fontVariant=i,r.style.fontWeight=o,r.style.font}(this.fontFamily,this.fontSize,this.fontStyle,this.fontVariant,this.fontWeight)}checkFontFace(){return!document.fonts||!document.fonts.check||document.fonts.check(this.font)}loadFontFace(){return document.fonts&&document.fonts.load?document.fonts.load(this.font):Promise.resolve()}createDrawable(){let{alignment:t,color:e,font:n,fontSize:i,lineGap:o,padding:r,strokeColor:l,strokeWidth:s,text:a}=this;r*=i,o*=i,s*=i;let f=a?a.split("\n"):[],h=f.length,d=i+o,c=h?(()=>{let t=document.createElement("canvas").getContext("2d");return t.font=n,Math.max(...f.map((e=>t.measureText(e).width)))})():0,m=r+s/2,u=c+2*m;return{width:u,height:(h?i+d*(h-1):0)+2*m,draw(o){let r,a=m+i/2;Object.assign(o,{fillStyle:e,font:n,lineWidth:s,miterLimit:1,strokeStyle:l,textAlign:(()=>{switch(t){case"left":return r=m,"left";case"right":return r=u-m,"right"}return r=u/2,"center"})(),textBaseline:"middle"}),f.forEach((t=>{o.fillText(t,r,a),s&&o.strokeText(t,r,a),a+=d}))}}}};return n.prototype.isTextTexture=!0,n}));
